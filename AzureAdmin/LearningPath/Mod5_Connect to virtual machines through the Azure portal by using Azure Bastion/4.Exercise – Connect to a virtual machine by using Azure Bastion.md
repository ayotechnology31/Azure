https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/4-exercise-connect-vm-with-bastion

Exercise â€“ Connect to a virtual machine by using Azure Bastion

15 minutes

In this unit, you'll create a virtual machine (VM) to act as your internal app VM and deploy Azure Bastion to connect to it.
This exercise is optional. To complete it, you need access to an Azure subscription where you have permissions to create resources like a VM. If you don't have an Azure subscription, create a free account before you begin.

Create a resource group

Create a resource group to contain all the resources that you'll create for the exercises.

1. Sign in to the Azure portal.

2. Search for or select Resource groups.

3. Select Add.

4. Enter the following values for the resource group.

Field	| Value
------------- | -------------
Subscription	| Select your subscription
Resource group	| learn-bastion-rg
Region	| Choose the region near you

5. Select Review + create > Create.

**Create a VM**

Create a Linux VM that's not exposed to the internet.

1. In the Azure portal, search for or select Virtual machines.
2. Select Add > Virtual machine.
3. Enter the following values to the Basics page.

Field	Value
------------- | -------------
Subscription	| Your subscription
Resource group |	learn-bastion-rg
Virtual machine name| 	internalappvm
Region | 	Choose a region near you
Image	 | Ubuntu Server 18.04 LTS - Gen1
Username	| azureuser
SSH public key source	 | Generate new key pair
Key pair name	| internalappvm_key
Public inbound ports	| None

Use the default values for the rest of the fields on this page.

4. Select the Networking tab.
5. Change the following values.

Field	| Value
------------- | -------------
Public IP	| None
Public inbound ports	|  None


6. Select Review + create > Create.
7. Select Download private key and create resource. Screenshot of the Generate new key pair window with the Download private key button highlighted.

![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-download-private-key.png)

Because you created the internal app VM without a public IP, you can't connect to it over the internet. Instead of using a jumpbox VM to connect to the internal app VM, let's use Azure Bastion.


**Create a subnet for Azure Bastion**
Before you can use Azure Bastion, you need to create a subnet on the virtual network that the internal app VM uses.

In the Azure portal, select or search for Resource groups.

1. Select learn-bastion-rg.
2. From the list of resources, select the virtual network learn bastion-rg-vnet.
Under Settings, select Address space.
3. Enter an address space with a subnet mask that's /27 or larger, like /26, /25, and so on. An example is 10.0.1.0/24.
4. Select Save.
5. Under Settings, select Subnets.
6. Select + Subnet to add a subnet.
7. Enter the following information to create a subnet.
 
 Screenshot of the Add subnet page where the subnet name is AzureBastionSubnet.
 ![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-add-bastion-subnet.png)
 
Field	| Name
------------- | -------------
Name | 	AzureBastionSubnet
Subnet address range	 | The address space you just added, like 10.0.1.0/24


Use the default values for the rest of the fields.

10. Select OK.


**Deploy Azure Bastion**
1. In the Azure portal, select or search for Virtual machines.
2. Select the virtual machine internalappvm.
3. Select Connect > Bastion > Use Bastion.
 
 Screenshot of the Connect page and Bastion tab, with the Use Bastion button.
![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-connect-bastion.png)

4. Review and use the default values like the Azure Bastion resource name, subnet, and the option to create a new public IP address.
 Screenshot of the Connect using Azure Bastion page with fields filled out by default, like Azure Bastion resource name, subnet, and create new public IP address.

![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-operations-bastion.png)
5. Select Create.

Wait a few minutes for the Azure Bastion resource to be created.


**Connect to the internal app VM**
1. After the Azure Bastion resource is created, you're prompted to enter credentials to connect to the VM.
2. Enter the username azureuser.
3. Select SSH Private Key from local file.
4. For Local file, select the internalappvm_key.ppe file that you downloaded when you created the VM.
 Screenshot of the Azure Bastion connection page with the user name and local file fields populated.

![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-ready-to-connect.png)
5. Select Connect.
6. In the remote shell, enter Linux commands like the following command that updates the system.

 Screenshot of a browser that shows an Ubuntu terminal session.

![alt text](https://docs.microsoft.com/en-us/learn/modules/connect-vm-with-azure-bastion/media/4-ubuntu-session.png)
    Bash

    Copy
    sudo apt-get -y update

7. When you're finished, enter exit.
The next time you want to connect to the internal app VM, go to the virtual machine, select Bastion, and enter your credentials.

Next unit: Monitor and manage remote sessions
